# Пошаговая инструкция по созданию дашборда в Excel 

Исходные данные [Sample - Superstore.xls](https://github.com/Data-Learn/data-engineering/blob/master/DE-101%20Modules/Module01/DE%20-%20101%20Lab%201.1/Sample%20-%20Superstore.xls?raw=true)<br>
Пример дашборда [Sample - Superstore - Dashboard.xlsx](https://github.com/Data-Learn/data-engineering/blob/master/DE-101/Module-01/Lab/Sample%20-%20Superstore%20-%20Dashboard.xlsx) (версия excel 2016+)

Если у вас есть какие-то предложения, дополнения или исправления, то прошу не стесняйтесь и присылайте свои правки. Давайте объединим усилия и сделаем реально крутой ресурс :)

**1. Знакомимся с исходными данными**

Скачиваем с репозитория в гитхабе файл [Sample - Superstore.xls](https://github.com/Data-Learn/data-engineering/blob/master/DE-101%20Modules/Module01/DE%20-%20101%20Lab%201.1/Sample%20-%20Superstore.xls?raw=true). В файле видим 3 вкладки: Orders, People, Returns. 
Со значениями артибутов можно ознакомиться в [описании задания](https://github.com/Data-Learn/data-engineering/tree/master/DE-101%20Modules/Module01/DE%20-%20101%20Lab%201.1)

Сначала оформим данные на листе Orders как таблицу. Благодаря этому Excel будет понимать, что это таблица, и автоматически расширять ее, если мы добавим новый столбец или добавим новые строки с данными. Что очень удобно, если отчет регулярный. Просто добавляем данные за последний период и одним нажатием [обновляем данные в сводных таблицах](https://support.office.com/ru-ru/article/%D0%BE%D0%B1%D0%BD%D0%BE%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5-%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85-%D0%B2-%D1%81%D0%B2%D0%BE%D0%B4%D0%BD%D0%BE%D0%B9-%D1%82%D0%B0%D0%B1%D0%BB%D0%B8%D1%86%D0%B5-6d24cece-a038-468a-8176-8b6568ca9be2)

Итак, выделяем имеющиеся данные на листе Orders и используем команду &quot;Форматировать как таблицу&quot; или горячие клавиши &quot;Crtl+T&quot;

![image](https://i.ibb.co/Km9rKLR/2.png)

Теперь перейдем во вкладку &quot;Конструктор&quot; и зададим таблице имя. К примеру, &quot;Data&quot;, чтобы потом быстро к ней обращаться.

![image](https://i.ibb.co/8m6J7Bm/3.png)

Теперь нам надо объединить все данные в одну таблицу и в дальнейшем работать только с ней. Помимо удобства, это также даст возможность строить фильтры и срезы, которые будут применяться сразу ко все данным и диаграммам в дашборде.<br><br>
*Пример: когда мы отфильтруем по дате и по региону, диаграммы автоматически перестроятся*
![image](https://i.ibb.co/8sjKJG8/1.png)

**2. Объединяем данные**

Объединять данные будем во вкладке Orders. Там по умолчанию больше всего данных, есть общие поля с другими таблицами: &quot;Region&quot;, &quot;Order ID&quot;. Ну и самое важное именно здесь у нас [минимальная грануляция](https://youtu.be/3ncC-l-nkOo?t=552) . Значит, мы сможем построить более детализированные отчеты.

Для начала добавим недостающие столбцы &quot;Person&quot; и &quot;Returned&quot;

![image](https://i.ibb.co/WKd3V7L/4.png)

Чтобы подтянуть данные из вкладки People, можно воспользоваться функцией [Если](https://support.office.com/ru-ru/article/%D0%B5%D1%81%D0%BB%D0%B8-%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D1%8F-%D0%B5%D1%81%D0%BB%D0%B8-69aed7c9-4e8a-4755-a9bc-aa8bbff73be2). Я не буду на ней подробно останавливаться, т.к лучше [официальной справки](https://support.office.com/ru-ru/article/%D0%B5%D1%81%D0%BB%D0%B8-%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D1%8F-%D0%B5%D1%81%D0%BB%D0%B8-69aed7c9-4e8a-4755-a9bc-aa8bbff73be2) с этим вряд ли кто справится. Там все на русском с видео и примерами.<br>
`
=ЕСЛИ(M2=People!$B$5;People!$A$5;)
`
<br>
![image](https://i.ibb.co/KXfWVgn/5.png)

Только у нас не одно, а четыре условия. В Excel без проблем можно использовать [вложенные функции](https://support.office.com/ru-ru/article/%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-%D0%B2%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%BD%D1%8B%D1%85-%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D0%B9-%D0%B2-%D1%84%D0%BE%D1%80%D0%BC%D1%83%D0%BB%D0%B5-9d7c966d-6030-4cd6-a052-478d7d844166), этим и воспользуемся.
`
=ЕСЛИ(M2=People!$B$5;People!$A$5;ЕСЛИ(M2=People!$B$4;People!$A$4;ЕСЛИ(M2=People!$B$3;People!$A$3;ЕСЛИ(M2=People!$B$2;People!$A$2;0))))
`
В итоге получаем таблицу, где для каждого региона указан его менеджер

![image](https://i.ibb.co/dg2fS7G/6.png)

Чтобы подтянуть данные по возвратам из вкладки Returns, можно воспользоваться сразу несколькими функциями [ИНДЕКС](https://support.office.com/ru-ru/article/%D0%B8%D0%BD%D0%B4%D0%B5%D0%BA%D1%81-%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D1%8F-%D0%B8%D0%BD%D0%B4%D0%B5%D0%BA%D1%81-a5dcf0dd-996d-40a4-a822-b56b061328bd)+ [ПОИСКПОЗ](https://support.office.com/ru-ru/article/%D0%BF%D0%BE%D0%B8%D1%81%D0%BA%D0%BF%D0%BE%D0%B7-%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D1%8F-%D0%BF%D0%BE%D0%B8%D1%81%D0%BA%D0%BF%D0%BE%D0%B7-e8dffd45-c762-47d6-bf89-533f4a37673a) и [ЕСЛИОШИБКА](https://support.office.com/ru-ru/article/%D0%B5%D1%81%D0%BB%D0%B8%D0%BE%D1%88%D0%B8%D0%B1%D0%BA%D0%B0-%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D1%8F-%D0%B5%D1%81%D0%BB%D0%B8%D0%BE%D1%88%D0%B8%D0%B1%D0%BA%D0%B0-c526fd07-caeb-47b8-8bb6-63f3e417f611)<br>
`
=ЕСЛИОШИБКА(ИНДЕКС(Returns!A:A;ПОИСКПОЗ(B2;Returns!B:B;0));"No")
`
<br><br>В качестве альтернативы можно использовать функцию ВПР (VKLOOKUP). 
<br><br>
`
=ЕСЛИОШИБКА(ВПР([@[Order ID]];Returns!$A:$B;2;0);"No")`
<br><br>
Но у нее есть жесткие ограничения. В частности, искомые данные должны находиться справа от столбца с критерием. Когда данные раположены слева от критерия, то приходится переставлять столбцы местами.<br>
<br>
  ![image](https://i.ibb.co/87q8MhZ/vpr.jpg)
  ![image](https://i.ibb.co/WxHJ1K7/vpr2.jpg)
<br><br>

[Ролик на youtube по ВПР](https://youtu.be/nNUx72wmLjs)<br>
[Ролик на youtube по ИНДЕКС И ПОИСКПОЗ](https://youtu.be/nbwj6LEx6cQ)<br>
<br>Наверняка есть и другие решения, добавляйте ;)

Итак, данные сведены на одном листе и можем приступать к отчетам

**3. Определяемся с отчетами**

Очень важно определиться с тем, что мы будем выводить и в каком виде. От этого напрямую будут зависеть результаты последующего анализа. Чтобы понимать, какие показатели действительно важны и какой уровень детализации для них нужен, нам не обойтись без знания предметной области.

Если вы делаете отчет не для себя или в целях обучения, то крайне рекомендую предварительно обсудить его содержание с заинтересованными лицами, а уже потом приступать к реализации. Сэкономите себе и другим много времени ;)

Т.к это обучающий курс, то мы ограничены только нашей фантазией.
Можете воспользоваться [идеями Дмитрия](https://github.com/Data-Learn/data-engineering/tree/master/DE-101%20Modules/Module01/DE%20-%20101%20Lab%201.1), можете свои придумать.

Я остановился на следующем:

| **Параметры и показатели** | **Визуализация** |
| --- | --- |
| Динамика дохода и прибыли | Диаграмма-график |
| Категории товаров(сравнение) | Линейчатая диаграмма |
| Региональные менеджеры(сравнение) | Гистограмма |
| Сегменты(сравнение) | Гистограмма |
| Динамика по сегментам | Диаграмма-график |
| Основные показатели | Спарклайны |
| По штатам | Картограмма |
| По регионам(сравнение) | Круговая |
| По возвратам в % | Круговая |

Визуализация это вообще отдельная тема, в двух словах не расскажешь.
Для начала можно использовать небольшие шпаргалки вроде таких: [Andrew Abela](https://drive.google.com/file/d/1dQcaaIjvLxycUxz8_R5diD4JQ26x4tO0/view) или [Ganna Ponomaryova](https://drive.google.com/file/d/1iuFfN0DZ5shLzm-BzukJY4XlpiqZmlsZ/view) (на русском)

**4. Создаем первую сводную таблицу и диаграмму**

Вставка -> Сводная таблица

![image](https://i.ibb.co/1rGF0HN/7.png)

Задаем имя таблицы откуда будем забирать данные (у нас это Data) и помещаем ее на новый лист. Новый лист и сводную таблицу для дальнейшего удобства лучше сразу переименовать.

У нас появляется [сводная таблица](https://support.office.com/ru-ru/article/%D1%81%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5-%D1%81%D0%B2%D0%BE%D0%B4%D0%BD%D0%BE%D0%B9-%D1%82%D0%B0%D0%B1%D0%BB%D0%B8%D1%86%D1%8B-%D0%B4%D0%BB%D1%8F-%D0%B0%D0%BD%D0%B0%D0%BB%D0%B8%D0%B7%D0%B0-%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85-%D0%BB%D0%B8%D1%81%D1%82%D0%B0-a9a84538-bfe9-40a9-a8e9-f99134456576) и мы можем приступить к ее настройке

![image](https://i.ibb.co/Bf4zbHX/8.png)

Допустим, мы решили отобразить динамику дохода и прибыли.

Т.к это динамика, нам нужна дата. Перетаскиваем параметр даты (у нас это Order Date) в область строк.

Excel автоматически сгруппировал нашу дату на месяцы, кварталы и годы.

![image](https://i.ibb.co/mv5fZb6/9.png)

Но мы можем самостоятельно указать нужную нам группировку.

Правой кнопкой мыши вызываем контекстное меню и там выбираем &quot;Группировать&quot; и затем выбираем нужную нам разбивку и диапазон дат.

![image](https://i.ibb.co/RBNZfRD/10.png) ![image](https://i.ibb.co/sJj16Rx/10-2.png)

Сводную таблицу мы можем настроить под себя как угодно.

Например, при группировке даты excel создал отдельные столбцы для года и месяца, а мы хотим, чтобы все было в одном.

Выделяем таблицу -> Вкладка конструктор -> Макет отчета -> Показать в сжатой форме

![image](https://i.ibb.co/qkMgqcH/11.png)

Готово

![image](https://i.ibb.co/6WcfryG/12.png)

Теперь нам нужно добавить в таблицу метрики.

Перетаскиваем показатели Sales и Profit в область &quot;Значения&quot;

![image](https://i.ibb.co/GJxsyN7/13.png)

Преобразуем числа в таблице в денежный формат и округлим до целого

![image](https://i.ibb.co/2ZGhGT1/14.png)

![image](https://i.ibb.co/rsYNzNr/15.png)

![image](https://i.ibb.co/7nRtVj8/16.png)

Теперь построим диаграмму.

Выбираем таблицу -> Вкладка анализ ->Сводная диаграмма

![image](https://i.ibb.co/n8G9Kdr/17.png)

Для динамики хорошо подходит график, его и выбираем

![image](https://i.ibb.co/19pncQM/18.png)

Настраиваем его под наши нужды, убираем кнопки полей

![image](https://i.ibb.co/xfBgCQH/19.png)

добавляем заголовки

![image](https://i.ibb.co/1ZSfzCf/20.png)

настраиваем, как нам нужно

![image](https://i.ibb.co/WPw8mM3/21.png)

**5. Копируем получившийся лист и по-аналогии делаем для других.**

**6. Делаем дашборд**

Создать дашборд совсем просто, всю основную работу мы уже сделали.

  Создаем новую вкладку, куда просто копируем получившиеся диаграммы со всех листов.
  Затем добавляем срезы(фильтры)

  Выбираем любую диаграмму, должны появиться поля сводной диаграммы.

  ![image](https://i.ibb.co/Sw29fH8/22.png)

  Если они не появились, включаем их в Анализировать->Список полей

  ![image](https://i.ibb.co/drp4BwG/23.png)

  В списке полей правой кнопкой мыши кликаем на параметр по которому будем фильтровать и в контекстном меню выбираем &quot;Добавить как срез&quot;

  ![image](https://i.ibb.co/7nFsgzs/24.png)

  Для полей с датами помимо среза также доступна временная шкала.
  
  Excel сам по умолчанию выберет сводные таблицы и соответственно диаграммы на которые срез будет действовать.
  Но иногда нужно скорректировать вручную.
  Кликаем правой кнопкой мыши по нужному срезу и выбираем подключение к отчетам

  ![image](https://i.ibb.co/V9Bb1nf/25.png)

  И там из всех ваших сводных таблицы выбираем нужные.
  У меня, например, на все действует. Т.к сводные построены на данных из одной и той же таблицы, то с этим никаких проблем нет.

  ![image](https://i.ibb.co/Sd4FZd8/26.png)

  По аналогии добавляем другие нужные нам срезы. Красиво все расставляем. Готово!
